---
Name: app-silverstripes3-flysystem
---
SilverStripe\Assets\InterventionBackend:
  flush_enabled: false
SilverStripe\S3\Adapter\CachedAwsS3V3Adapter:
  flush_enabled: false
---
Name: moosylvania-silverstripes3-flysystem-config
Only:
  envvarset: AWS_BUCKET_NAME
After:
  - '#assetsflysystem'
---
SilverStripe\Core\Injector\Injector:
  Aws\S3\S3Client:
    constructor:
      configuration:
        region: '`AWS_REGION`'
        version: latest
        credentials:
          key: '`AWS_ACCESS_KEY_ID`'
          secret: '`AWS_SECRET_ACCESS_KEY`'
  League\Flysystem\Filesystem.public:
    class: SilverStripe\Assets\Flysystem\Filesystem
    constructor:
      FilesystemAdapter: '%$SilverStripe\Assets\Flysystem\PublicAdapter'
      FilesystemConfig:
        visibility: public
        CacheControl: 'max-age=31536000'
---
Name: mooses3-cdn
Only:
  envvarset: AWS_PUBLIC_CDN_PREFIX
After:
  - '#assetsflysystem'
  - '#silverstripes3-flysystem'
  - '#silverstripes3-assetscore'
  - '#silverstripes3-cdn'
  - '#moosylvania-silverstripes3-flysystem-config'
---
SilverStripe\Core\Injector\Injector:
  SilverStripe\Assets\Flysystem\PublicAdapter:
    class: SilverStripe\S3\Adapter\PublicCDNAdapter
    constructor:
      s3Client: '%$Aws\S3\S3Client'
      bucket: '`AWS_BUCKET_NAME`'
      prefix: '`AWS_PUBLIC_BUCKET_PREFIX`'
      visibility: null
      mimeTypeDetector: null
      cdnPrefix: '`AWS_PUBLIC_CDN_PREFIX`'
      options: []
      cdnAssetsDir: '`AWS_PUBLIC_BUCKET_PREFIX`'
  League\Flysystem\Filesystem.public:
    class: SilverStripe\Assets\Flysystem\Filesystem
    constructor:
      FilesystemAdapter: '%$SilverStripe\Assets\Flysystem\PublicAdapter'
      FilesystemConfig:
        visibility: public
        CacheControl: 'max-age=31536000'
